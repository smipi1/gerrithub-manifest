#!/bin/sh /etc/rc.common
# Copyright (C) 2015 Philips Lighting BV

START=75
STOP=75
USE_PROCD=1

SERVICE_DAEMONIZE=1
SERVICE_WRITE_PID=1
SERVICE_PID_FILE=/var/run/hue-factoryreset.pid

HUE_FACTORYRESET=/usr/sbin/factoryreset_daemon
HUE_FACTORYRESET_VAR=/var/hue-factoryreset
HUE_FACTORYRESET_PIPE=${HUE_FACTORYRESET_VAR}/start
ARGS="-d $HUE_FACTORYRESET_PIPE"

# procd respawn settings
# RESTART_TIMEOUT = time(seconds) before next respawn
# FAIL_THRESHOLD = time(seconds) in which MAX_FAIL can be reached
# MAX_FAIL = max number of respawns within FAIL_THRESHOLD.
RESTART_TIMEOUT=10
FAIL_THRESHOLD=3600
MAX_FAIL=6

start_service() {
        mkdir -p ${HUE_FACTORYRESET_VAR}
        procd_open_instance
        procd_set_param command ${HUE_FACTORYRESET} ${ARGS}
        procd_set_param respawn $FAIL_THRESHOLD $RESTART_TIMEOUT $MAX_FAIL
        procd_set_param fail reboot
        procd_close_instance
}

stop() {
        service_stop ${HUE_FACTORYRESET}
}
